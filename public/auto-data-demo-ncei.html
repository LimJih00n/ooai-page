<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LabA 라이브 데모: AI 기반 자동 데이터 수집 (NCEI)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .code-block {
            background-color: #1e293b; /* slate-800 */
            color: #e2e8f0; /* slate-200 */
            font-family: 'Fira Code', monospace;
            padding: 1.5rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-size: 0.9rem;
            line-height: 1.6;
            border: 1px solid #334155; /* slate-700 */
        }
        .terminal-block {
            background-color: #0f172a; /* slate-900 */
            color: #94a3b8; /* slate-400 */
            font-family: 'Fira Code', monospace;
            padding: 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            line-height: 1.6;
            height: 300px;
            overflow-y: auto;
            border: 1px solid #334155; /* slate-700 */
        }
        .terminal-line::before {
            content: '$ ';
            color: #4ade80; /* green-400 */
        }
        .typing-cursor {
            display: inline-block;
            width: 8px;
            height: 1.2em;
            background-color: #f1f5f9; /* slate-100 */
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            50% {
                opacity: 0;
            }
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
        }
        .result-table th, .result-table td {
            border: 1px solid #e2e8f0; /* slate-200 */
            padding: 0.75rem;
            text-align: left;
        }
        .result-table th {
            background-color: #f1f5f9; /* slate-100 */
        }
    </style>
</head>
<body class="text-gray-800">
    <div class="container mx-auto px-4 py-12">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-teal-600 mb-2">LabA 핵심 기능 체험</h1>
            <p class="text-2xl text-gray-700 font-semibold">AI 에이전트 기반 자동 데이터 수집 (대기 과학)</p>
            <p class="mt-4 max-w-3xl mx-auto text-gray-600">
                "서울 지역의 2024년 1월 기온 및 강수량 데이터 수집"이라는 연구 목표가 주어졌을 때, LabA의 AI 에이전트가 어떻게 NCEI API를 활용하여 자율적으로 데이터를 수집하는지 확인해보세요.
            </p>
        </header>

        <div class="max-w-5xl mx-auto">
            <div class="text-center mb-8">
                <button id="start-demo-btn" class="bg-teal-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-teal-700 transition-colors text-lg shadow-lg">
                    라이브 데모 시작
                </button>
            </div>

            <div id="demo-container" class="hidden grid md:grid-cols-2 gap-8 items-start">
                <div>
                    <h2 class="text-xl font-bold mb-2">AI가 생성한 Python 코드</h2>
                    <p class="text-sm text-gray-500 mb-4">AI 에이전트가 연구 목표를 달성하기 위해 생성한 코드입니다.</p>
                    <div class="code-block"><pre id="code-output"></pre></div>
                </div>
                <div>
                    <h2 class="text-xl font-bold mb-2">가상 터미널 실행 로그</h2>
                    <p class="text-sm text-gray-500 mb-4">코드가 Docker 컨테이너 내부에서 실행되는 과정입니다.</p>
                    <div id="terminal-output" class="terminal-block"></div>
                </div>
            </div>

            <div id="result-container" class="hidden mt-12 bg-white p-8 rounded-lg shadow-xl border border-gray-200">
                <h2 class="text-2xl font-bold text-center mb-6 text-green-600">✅ 데이터 수집 및 처리 완료</h2>
                <p class="text-center text-gray-600 mb-6">수집된 데이터는 분석에 용이한 CSV 테이블 형태로 자동 정제되어 저장되었습니다.</p>
                <h3 class="text-lg font-semibold mb-4">수집 데이터 미리보기 (일부)</h3>
                <div class="overflow-x-auto">
                    <table class="result-table">
                        <thead>
                            <tr>
                                <th>date</th>
                                <th>AWND (m/s)</th>
                                <th>PRCP (mm)</th>
                                <th>TMAX (°C)</th>
                                <th>TMIN (°C)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>2024-01-01</td><td>2.5</td><td>0.0</td><td>1.8</td><td>-7.4</td></tr>
                            <tr><td>2024-01-02</td><td>2.1</td><td>0.0</td><td>2.5</td><td>-6.9</td></tr>
                            <tr><td>2024-01-03</td><td>1.9</td><td>0.3</td><td>3.1</td><td>-5.2</td></tr>
                            <tr><td>2024-01-04</td><td>2.8</td><td>0.0</td><td>1.1</td><td>-8.1</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const startBtn = document.getElementById('start-demo-btn');
        const demoContainer = document.getElementById('demo-container');
        const codeOutput = document.getElementById('code-output');
        const terminalOutput = document.getElementById('terminal-output');
        const resultContainer = document.getElementById('result-container');

        const code = "import requests\nimport pandas as pd\nfrom io import StringIO\n\n# 1. Configuration\nNCEI_API_TOKEN = '***' # AI가 안전하게 토큰을 관리합니다.\nSTATION_ID = 'GHCND:KOR00047122' # 서울 관측소\nSTART_DATE = '2024-01-01'\nEND_DATE = '2024-01-31'\nDATA_TYPES = 'TMAX,TMIN,PRCP,AWND'\nOUTPUT_CSV = 'seoul_weather_2024_01.csv'\n\n# 2. Construct API Request\nAPI_ENDPOINT = 'https://www.ncei.noaa.gov/cdo-web/api/v2/data'\nheaders = {'token': NCEI_API_TOKEN}\nparams = {\n    'datasetid': 'GHCND',\n    'stationid': STATION_ID,\n    'startdate': START_DATE,\n    'enddate': END_DATE,\n    'datatypeid': DATA_TYPES,\n    'limit': 1000,\n    'units': 'metric'\n}\n\n# 3. Fetch and Process Data\nprint(f\"Fetching data for {STATION_ID}...\")\nresponse = requests.get(API_ENDPOINT, headers=headers, params=params)\ndata = response.json().get('results', [])\n\ndf = pd.DataFrame(data)\npivot_df = df.pivot_table(index='date', columns='datatype', values='value')\npivot_df.to_csv(OUTPUT_CSV)\n\nprint(f\"Successfully saved data to {OUTPUT_CSV}\")\n";

        const terminalLogs = [
            "LabA Docker 컨테이너 환경 활성화...",
            "Python 3.10 및 pandas, requests 라이브러리 확인.",
            "대기 데이터 수집 에이전트 실행...",
            "NOAA NCEI API 엔드포인트에 연결 중...",
            "API 토큰 인증 성공. 데이터 요청 시작.",
            "Station KOR00047122 (서울) 데이터 요청.",
            "수신된 JSON 데이터 처리 중...",
            "Pandas를 사용하여 데이터프레임으로 변환 및 피벗.",
            "CSV 파일로 저장: seoul_weather_2024_01.csv",
            "작업 완료. 결과가 저장되었습니다."
        ];

        function typeCode(element, text, callback) {
            let i = 0;
            element.innerHTML = '';
            const interval = setInterval(() => {
                if (i < text.length) {
                    let char = text.charAt(i);
                    if (char === '\\n') char = '<br>';
                    element.innerHTML += char;
                    i++;
                } else {
                    clearInterval(interval);
                    if (callback) callback();
                }
            }, 20);
        }

        function showLogs(element, logs, callback) {
            let i = 0;
            element.innerHTML = '';
            const interval = setInterval(() => {
                if (i < logs.length) {
                    const line = document.createElement('p');
                    line.className = 'terminal-line';
                    line.textContent = logs[i];
                    element.appendChild(line);
                    element.scrollTop = element.scrollHeight;
                    i++;
                } else {
                    clearInterval(interval);
                    if (callback) callback();
                }
            }, 800);
        }

        startBtn.addEventListener('click', () => {
            startBtn.disabled = true;
            startBtn.textContent = '데모 실행 중...';
            demoContainer.classList.remove('hidden');
            resultContainer.classList.add('hidden');

            const codeWithCursor = code + '<span class="typing-cursor"></span>';
            
            typeCode(codeOutput, code, () => {
                codeOutput.innerHTML = code;
            });

            showLogs(terminalOutput, terminalLogs, () => {
                resultContainer.classList.remove('hidden');
                startBtn.disabled = false;
                startBtn.textContent = '데모 다시 시작하기';
            });
        });
    </script>
</body>
</html>
